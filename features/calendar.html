<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duckling Calendar of Doom</title>
    <!-- FullCalendar CSS -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
    <!-- Tippy.js CSS for tooltips -->
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css" />
    <link href="https://fonts.googleapis.com/css2?family=Chewy&display=swap" rel="stylesheet" />

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff; /* Soft sky blue background */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        /* Floating visuals */
        .floating-asset {
            position: absolute;
            z-index: 1;
            animation: float 8s ease-in-out infinite;
            pointer-events: none;
        }

        .duck1 { top: 10%; left: 5%; animation-duration: 12s; width: 100px; }
        .duck2 { bottom: 15%; right: 10%; animation-duration: 10s; width: 150px; }
        .duck3 { top: 20%; right: 5%; animation-duration: 15s; width: 170px; }
        .bubble1 { top: 60%; left: 20%; animation-duration: 14s; width: 180px; }
        .bubble2 { top: 35%; left: 15%; animation-duration: 10s; width: 130px; }
        .bubble3 { bottom: 5%; right: 25%; animation-duration: 18s; width: 150px; }
        .bubble4 { top: 5%; left: 40%; animation-duration: 16s; width: 160px; }

        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-20px) rotate(5deg); }
            100% { transform: translateY(0); }
        }

        #calendar-container {
            width: 90%;
            max-width: 900px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            padding: 20px;
            z-index: 10; /* Keep the calendar on top */
        }

        h1 {
            color: #4a90e2;
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .control-panel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            width: 90%;
            max-width: 900px;
            z-index: 10;
        }

        .control-panel input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 20px;
            outline: none;
        }

        .control-panel button,
        #shuffle-button,
        #back-button {
            padding: 10px 20px;
            font-size: 1em;
            font-weight: bold;
            color: #fff;
            background-color: #ff69b4;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .control-panel button:hover,
        #shuffle-button:hover,
        #back-button:hover {
            transform: translateY(-2px);
        }

        /* Styling for calendar events */
        .fc-event {
            /* Text is now black for better visibility */
            color: #000 !important;
            border-radius: 5px;
            padding: 5px;
            font-size: 0.9em;
            transition: transform 0.3s ease-in-out;
        }
        
        .fc-event-main {
            color: #000;
        }
        
        /* Hide the event time */
        .fc-daygrid-event-time {
            display: none;
        }

        /* Animation for shuffling events */
        .shuffling {
            animation: bounce-in 0.5s ease-in-out;
        }
        @keyframes bounce-in {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Tippy.js tooltip styling */
        .tippy-box[data-theme='light-border'] {
            font-family: 'Chewy', sans-serif;
            font-size: 1.2em;
            color: #4a4a4a;
            background-color: #fff;
            border: 2px solid #ffdfba;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            padding: 10px;
        }
        
        /* Modal for displaying the comment */
        #comment-modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #comment-content {
            background-color: #fff;
            padding: 20px;
            border: 2px solid #ff69b4;
            border-radius: 15px;
            text-align: center;
            font-family: 'Chewy', sans-serif;
            font-size: 1.5em;
            color: #4a4a4a;
            position: relative;
            animation: modal-fade-in 0.5s;
        }

        #sassy-image {
            width: 100px;
            height: auto;
            margin-bottom: 10px;
        }

        @keyframes modal-fade-in {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .selected-day {
            background-color: #bbdefb !important; /* A slightly darker blue */
            border: 2px solid #2196f3;
        }
    </style>
</head>
<body>

    <!-- Floating assets as images -->
    <img src="../duck1.png" alt="Cute Duck" class="floating-asset duck1" />
    <img src="../duck1.png" alt="Cute Duck" class="floating-asset duck2" />
    <img src="../duck1.png" alt="Cute Duck" class="floating-asset duck3" />
    <img src="../bubble.png" alt="Bubble" class="floating-asset bubble1" />
    <img src="../bubble.png" alt="Bubble" class="floating-asset bubble2" />
    <img src="../bubble.png" alt="Bubble" class="floating-asset bubble3" />
    <img src="../bubble.png" alt="Bubble" class="floating-asset bubble4" />

    <h1>Duckling Calendar of Doom ðŸ—“</h1>

    <div class="control-panel">
        <input type="text" id="event-input" placeholder="Add a new chaotic event..." />
        <button id="add-event-button">Add Event</button>
    </div>

    <div id="calendar-container">
        <div id="calendar"></div>
    </div>
    
    <button id="back-button" onclick="window.location.href='../index.html'">Back to Dashboard</button>

    <!-- Modal for displaying comments -->
    <div id="comment-modal">
        <div id="comment-content">
            <img id="sassy-image" src="../duck1.png" alt="Sassy Duck">
            <div id="comment-text"></div>
        </div>
    </div>

    <!-- FullCalendar JS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
    <!-- Tippy.js JS for tooltips -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sarcastic quotes and quack sound
            const sarcasticQuotes = [
                "Oh look, another pointless meeting.",
                "Who needs lunch breaks anyway?",
                "This is a total waste of my time.",
                "Your attendance is mandatory... sadly.",
                "Is this a work event or a therapy session?",
                "This could have been an email.",
                "I'd rather be a duck. They don't have deadlines.",
                "Congratulations! You've successfully committed to another soul-crushing task.",
                "Another day, another descent into corporate mediocrity.",
                "Time to pretend to be productive.",
                "Oops, sorry! Did that mess up your schedule?",
                "My bad! Just a little chaos to spice things up.",
                "Whoops, looks like your deadlines had a little mix-up!"
            ];
            const quackSound = new Audio('../assets/sounds/quack.mp3');

            // Palettes for random event colors
            const pastelColors = [
                '#ffb3ba', '#ffdfba', '#ffffba', '#baffc9', '#bae1ff'
            ];

            // Initialize local storage with default events if it's empty
            if (!localStorage.getItem('calenDuckEvents')) {
                const defaultEvents = [
                    { title: 'Pointless Team Sync', start: '2025-08-05' },
                    { title: 'Project Update (or is it?)', start: '2025-08-12' },
                    { title: 'Lunch Break (don\'t count on it)', start: '2025-08-19' },
                    { title: 'Quarterly Review of Despair', start: '2025-08-26' }
                ];
                localStorage.setItem('calenDuckEvents', JSON.stringify(defaultEvents));
            }

            // Function to get events from local storage
            function getEventsFromLocalStorage() {
                return JSON.parse(localStorage.getItem('calenDuckEvents'));
            }

            // Function to save events to local storage
            function saveEventsToLocalStorage(events) {
                localStorage.setItem('calenDuckEvents', JSON.stringify(events));
            }

            // Function to get a random color from the palette
            function getRandomColor() {
                return pastelColors[Math.floor(Math.random() * pastelColors.length)];
            }
            
            // Function to show a modal with a random sassy comment
            function showCommentModal(text) {
                const modal = document.getElementById('comment-modal');
                const commentText = document.getElementById('comment-text');
                commentText.innerText = text;
                modal.style.display = 'flex';
                // Close modal after 3 seconds
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 3000);
            }

            // Initialize the calendar
            const calendarEl = document.getElementById('calendar');
            let selectedDateEl = null; // Variable to track the currently selected day element

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                initialDate: '2025-08-01',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,dayGridWeek,dayGridDay'
                },
                events: getEventsFromLocalStorage().map(event => ({
                    ...event,
                    backgroundColor: getRandomColor(),
                    textColor: '#000' // Ensure text is black
                })),
                eventDidMount: function(info) {
                    const quote = sarcasticQuotes[Math.floor(Math.random() * sarcasticQuotes.length)];
                    tippy(info.el, {
                        content: quote,
                        theme: 'light-border',
                        allowHTML: true,
                        placement: 'top',
                    });
                    info.el.addEventListener('mouseenter', () => {
                        try {
                            quackSound.currentTime = 0; // Rewind to the beginning
                            quackSound.play();
                        } catch (e) {
                            console.error("Audio playback failed:", e);
                        }
                    });
                },
                dateClick: function(info) {
                    // Remove highlight from previous day
                    if (selectedDateEl) {
                        selectedDateEl.classList.remove('selected-day');
                    }
                    // Add highlight to the new day
                    info.dayEl.classList.add('selected-day');
                    selectedDateEl = info.dayEl;

                    const eventInput = document.getElementById('event-input');
                    eventInput.dataset.selectedDate = info.dateStr;
                    eventInput.placeholder = 'Add event for ${info.dateStr}';
                }
            });

            calendar.render();

            // Function to shuffle events
            function shuffleEvents() {
                const allEvents = calendar.getEvents();
                
                const eventTitles = allEvents.map(e => e.title);
                const eventDates = allEvents.map(e => e.start);
                const eventColors = allEvents.map(e => e.backgroundColor);


                // Shuffle the dates, titles, and colors
                const shuffledDates = [...eventDates].sort(() => Math.random() - 0.5);
                const shuffledTitles = [...eventTitles].sort(() => Math.random() - 0.5);
                
                // Create a new array of event objects with shuffled properties
                const newEvents = [];
                for (let i = 0; i < allEvents.length; i++) {
                    newEvents.push({
                        title: shuffledTitles[i],
                        start: shuffledDates[i],
                        backgroundColor: eventColors[i], // Keep original colors
                        textColor: '#000'
                    });
                }
                
                // Remove all events and re-add them
                allEvents.forEach(event => event.remove());
                newEvents.forEach(event => calendar.addEvent(event));

                // Save the new state to local storage
                saveEventsToLocalStorage(newEvents);

                // Show an "Oops" comment after shuffling
                showCommentModal("Oops! Sorry! Did that mess up your schedule?");
            }

            // Add event logic and trigger shuffle after 3 seconds
            const eventInput = document.getElementById('event-input');
            document.getElementById('add-event-button').addEventListener('click', () => {
                const title = eventInput.value.trim();
                const selectedDate = eventInput.dataset.selectedDate || calendar.getDate().toISOString().split('T')[0];
                
                if (title) {
                    const events = getEventsFromLocalStorage();
                    const newEvent = {
                        title: title,
                        start: selectedDate,
                        backgroundColor: getRandomColor(),
                        textColor: '#000'
                    };
                    events.push(newEvent);
                    saveEventsToLocalStorage(events);
                    calendar.addEvent(newEvent);
                    eventInput.value = '';
                    eventInput.placeholder = "Add a new chaotic event...";

                    // Show passive-aggressive comment and sassy image immediately
                    showCommentModal();

                    // Automatically shuffle events after a 3-second delay
                    setTimeout(shuffleEvents, 3000);
                }
            });
        });
    </script>
</body>
</html>